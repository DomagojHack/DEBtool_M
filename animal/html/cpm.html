
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>cpm</title><meta name="generator" content="MATLAB 9.1"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-03-02"><meta name="DC.source" content="cpm.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>cpm</h1><!--introduction--><p>runs a cohort projection model using a generalized reactor</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Syntax</a></li><li><a href="#4">Description</a></li><li><a href="#5">Remarks</a></li><li><a href="#6">Example of use</a></li></ul></div><h2 id="3">Syntax</h2><p>tXN = <a href="../cpm.m"><b>cpm</b></a> (species, tT, tx, h)</p><h2 id="4">Description</h2><p>Plot population trajectories in a generalised reactor for selected species of cohorts that periodically reproduce synchroneously. The number of cohorts equals the max age in years plus 1. The parameters of species are obtained either from allStat.mat, or from a cell-string {par, metaPar, metaData}. The first 3 cells are output structures of <a href="http://www.debtheory.org/wiki/index.php?title=Mydata_file"><b>mydata_my_pet</b></a> and <a href="http://www.debtheory.org/wiki/index.php?title=Pars_init_file"><b>pars_init_my_pet</b></a>, as part of the parameter estimation process. Structure metadata is required to get species-name, T_typical and ecoCode, metaPar to get model. If dioecy applies, the sex-ratio is assumed to be 1:1 and fertilisation is assumed to be sure. The energy cost for male-production is taken into account by halving kap_R. The initial population is a single fertilized (female) egg, fertilisation is alswyas taken to be sure. Starvation parameters are added to parameter structure, if not present. Default: max shrinking fraction del_X = 0.7, maturity decay k_JX = k_J and maturity hazard h_J = 1e-2 1/d; If specified background hazards in 4th input are too high, the population goes extinct.</p><p>Input:</p><div><ul><li>species: character-string with name of entry or cellstring with structures: {metaData, metaPar, par}</li><li>tT: optional (nT,2)-array with time and temperature in Kelvin (default: T_typical); time scaled between 0 (= start) and 1 (= end of cycle)     If scalar, the temperature is assumed to be constant</li><li>tx: optional (nX,2)-array with time and food density in supply as fraction of half saturation constant K (default: 1); time scaled between 0 (= start) and 1 (= end of cycle)     If scalar, the food density in the supply is assumed to be constant</li><li>h: optional vector with supply, dilution and background hazards for each stage (depending on the model) and boolean for thinning     Default value for the std model: [h_X, h_D, h_B0b, h_Bbp, h_Bpi, thin] = [1e-2 0 0 0 0 0]</li><li>nt: optional scalar with number of reproduction events to be simulated (default 100).</li></ul></div><p>Output:</p><div><ul><li>tXN: (n,m)-array with times, food density and number of individuals in the various cohorts</li></ul></div><h2 id="5">Remarks</h2><p>If species is specified by string (rather than by data), its parameters are obtained from allStat.mat. The starvation parameters can only be set different from the default values by first input in the form of data and adding them to the par-structure.</p><h2 id="6">Example of use</h2><div><ul><li>If results_My_Pet.mat exists in current directory (where "My_Pet" is replaced by the name of some species, but don't replace "my_pet"):   load('results_My_Pet.mat'); prt_my_pet_pop({metaData, metaPar, par}, [], T, f, destinationFolder)</li><li>cmp('Rana_temporaria')</li><li>cmp('Rana_temporaria', C2K(22))</li><li>cmp('Rana_temporaria', [0 .25 .75; C2K([10 25 7])]', 5)</li><li>cmp('Rana_temporaria', [], [0 .25 .75; 6 8 .8]')</li></ul></div><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% cpm
% runs a cohort projection model using a generalized reactor

%%
function tXN = cpm(species, tT, tx, h)
% created 2020/03/02 by Bob Kooi and Bas Kooijman

%% Syntax
% tXN = <../cpm.m *cpm*> (species, tT, tx, h) 

%% Description
% Plot population trajectories in a generalised reactor for selected species of cohorts that periodically reproduce synchroneously. 
% The number of cohorts equals the max age in years plus 1.
% The parameters of species are obtained either from allStat.mat, or from a cell-string {par, metaPar, metaData}.
% The first 3 cells are output structures of <http://www.debtheory.org/wiki/index.php?title=Mydata_file *mydata_my_pet*> and
% <http://www.debtheory.org/wiki/index.php?title=Pars_init_file *pars_init_my_pet*>, as part of the parameter estimation process.
% Structure metadata is required to get species-name, T_typical and ecoCode, metaPar to get model.
% If dioecy applies, the sex-ratio is assumed to be 1:1 and fertilisation is assumed to be sure.
% The energy cost for male-production is taken into account by halving kap_R.
% The initial population is a single fertilized (female) egg, fertilisation is alswyas taken to be sure.
% Starvation parameters are added to parameter structure, if not present.
% Default: max shrinking fraction del_X = 0.7, maturity decay k_JX = k_J and maturity hazard h_J = 1e-2 1/d;
% If specified background hazards in 4th input are too high, the population goes extinct.
%
% Input:
%
% * species: character-string with name of entry or cellstring with structures: {metaData, metaPar, par}
% * tT: optional (nT,2)-array with time and temperature in Kelvin (default: T_typical); time scaled between 0 (= start) and 1 (= end of cycle)
%     If scalar, the temperature is assumed to be constant
% * tx: optional (nX,2)-array with time and food density in supply as fraction of half saturation constant K (default: 1); time scaled between 0 (= start) and 1 (= end of cycle)
%     If scalar, the food density in the supply is assumed to be constant
% * h: optional vector with supply, dilution and background hazards for each stage (depending on the model) and boolean for thinning
%     Default value for the std model: [h_X, h_D, h_B0b, h_Bbp, h_Bpi, thin] = [1e-2 0 0 0 0 0]  
% * nt: optional scalar with number of reproduction events to be simulated (default 100).
%
% Output:
%
% * tXN: (n,m)-array with times, food density and number of individuals in the various cohorts
%
%% Remarks
% If species is specified by string (rather than by data), its parameters are obtained from allStat.mat.
% The starvation parameters can only be set different from the default values by first input in the form of data and adding them to the par-structure.

%% Example of use
%
% * If results_My_Pet.mat exists in current directory (where "My_Pet" is replaced by the name of some species, but don't replace "my_pet"):
%   load('results_My_Pet.mat'); prt_my_pet_pop({metaData, metaPar, par}, [], T, f, destinationFolder)
% * cmp('Rana_temporaria')
% * cmp('Rana_temporaria', C2K(22))
% * cmp('Rana_temporaria', [0 .25 .75; C2K([10 25 7])]', 5)
% * cmp('Rana_temporaria', [], [0 .25 .75; 6 8 .8]')

% get parameters (2 possible routes for getting pars)
if iscell(species) 
  metaData = species{1}; metaPar = species{2}; par = species{3};  
  species = metaData.species;
  par.reprodCode = metaData.ecoCode.reprod(1);
  par.genderCode = metaData.ecoCode.gender(1);
  datePrintNm = ['date: ',datestr(date, 'yyyy/mm/dd')];
else  % use allStat.mat as parameter source 
  reprodCode = read_eco({species}, 'reprod'); par.reprodCode = reprodCode(1);
  genderCode = read_eco({species}, 'gender'); par.genderCode = genderCode(1);
  [par, metaPar, txtPar, metaData] = allStat2par(species); 
  datePrintNm = ['allStat version: ', datestr(date_allStat, 'yyyy/mm/dd')];
end

% hazard rates and thinning
if ~exist('h','var') || isempty(h)
  par.h_X = 1e-2; par.h_D = 0; par.thin = 0;
else
  par.h_X = h(1); par.h_D = h(2); par.thin = h(end);
end
model = metaPar.model;
switch model
  case {'std','stf','sbp','abp'}
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbp = 0; par.h_Bpi = 0; 
    else
      par.h_B0b = h(3); par.h_Bbp = h(3); par.h_Bpi = h(5);       
    end
  case 'stx'
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbx = 0; par.h_Bxp = 0; par.h_Bpi = 0; 
    else
      par.h_B0b = h(3); par.h_Bbx = h(4); par.h_Bxp = h(5); par.h_Bpi = h(6);       
    end
  case 'ssj'
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbs = 0; par.h_Bsj = 0; par.h_Bjp = 0; par.h_Bpi = 0; 
    else
      par.h_B0b = h(3); par.h_Bbs = h(4); par.h_Bsp = h(5); par.h_Bpi = h(6);       
    end
  case 'abj'
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbj = 0; par.h_Bjp = 0; par.h_Bpi = 0; 
    else
      par.h_B0b = h(3); par.h_Bbj = h(4); par.h_Bjp = h(5); par.h_Bpi = h(6);       
    end
  case 'asj'
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbs = 0;par.h_Bsj = 0; par.h_Bjp = 0; par.h_Bpi = 0; 
    else
      par.h_B0b = h(3); par.h_Bbs = h(4); par.h_Bsj = h(5); par.h_Bjp = h(6); par.h_Bpi = h(7);       
    end
  case 'hep'
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbp = 0; par.h_Bpj = 0; par.h_Bji = 0; 
    else
      par.h_B0b = h(3); par.h_Bbp = h(4); par.h_Bpj = h(5);  par.h_Bji = h(6);       
    end
  case 'hex'
    if ~exist('h','var') || isempty(h)
      par.h_B0b = 0; par.h_Bbj = 0; par.h_Bje = 0; par.h_Bei = 0; 
    else
      par.h_B0b = h(3); par.h_Bbj = h(4); par.h_Bje = h(5); par.h_Bei = h(6);    
    end
  otherwise
    return
end

% temperature
if ~exist('tT','var') || isempty(tT)
  T = metaData.T_typical; tT = [0 T; 1 T];
elseif legnth(tT) == 1
  tT = [0 tT; 1 tT];
end

% scaled supply food density x = X/K
if ~exist('tx','var') || isempty(tX)
  tx = [0 1; 1 1];
elseif length(tx)  == 1
  tx = [0 tx; 1 tx];
end

% starvation parameters
if ~isfield('par.del_X')
  par.del_X = 0;
end
if ~isfield('par.k_JX')
  par.k_JX = k_J;
end
if ~isfield('par.h_J')
  par.h_J = 1e-2;
end



##### SOURCE END #####
--></body></html>